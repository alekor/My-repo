<html>
	<head>
		<meta charset=utf-8>
		<title>Tic Tac Toe</title>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
		<style type="text/css">
			* {
				margin: 0;
				padding: 0;
			}
			.game-field {
				width: 320px;
				margin: 50px auto;
			}

			.game-field>span {
				display: inline-block;
				width: 100px;
				height: 100px;
				border: 1px solid #000;
				background: #ccc;
				vertical-align: middle;
				color: #fff;
				font: 80px/90px verdana, arial;
				text-align: center;
				margin: -3px;
			}
		</style>
	</head>
	<body>
		<div class="game-field">
			<span id="cell_1"></span>
			<span id="cell_2"></span>
			<span id="cell_3"></span>
			<span id="cell_4"></span>
			<span id="cell_5"></span>
			<span id="cell_6"></span>
			<span id="cell_7"></span>
			<span id="cell_8"></span>
			<span id="cell_9"></span>
		</div>	

		<script type="text/javascript">

			var	cell = document.getElementsByTagName("span"),
				type = 'cross',
				myTurn = true;

				for (var i=0; i<9; i++)
				{
					cell[i].onclick = function()
					{
							id = this.id; 
							if(makeMove(id, type))
							{
								myTurn = false;
								$.ajax(
								{
									url: '/make_move.php',
									type: 'GET',
									dataType: 'json',
									data: {type:type, id:id}
								});
							}
								
					}
				}
				
				setInterval('getMoves()', 1000);
				
				function getMoves()
				{
					$.ajax(
					{
						url: 'get_moves.php',
						type: 'GET',
						dataType: 'json',
						data: {type:type},
						complete: function(result)
						{
							console.log(result.response.myTurn);
							if(result.myTurn == '1')
							{
								console.log(result.myTurn);
								myTurn = true;
								moves = result.moves;
								for (move in moves)
								{
									makeMove(moves.move.id, moves.move.type);
								}
							}
							
						}
					});
				}

				function makeMove(id, type) {
					var field = document.getElementById(id),
						hasChild = field.hasChildNodes(); 
					if (myTurn == true && hasChild == false)
					{
						var sign = document.createElement("span");
						if (type == 'cross') {
							field.appendChild(sign);
							sign.innerHTML = "X";
						} else if (type == 'zero') {
							field.appendChild(sign);
							sign.innerHTML = "O";
						}
						return true;
					}				
					return false;	
					console.log(hasChild);
				}

				





				// field.onclick = function() {
				// 	makeMove(id, type);
				// 	myTurn = false;
				// };



				// field.onclick = function() {
				// 	makeMove(id, type);
				// 	myTurn = false;
				// };



				
				// for (var i=0; i<9; i++) {
				// 	cell[i].onclick = function() {
				// 		this.appendChild(sign);
				// 		this.innerHTML = "X";
				// 	};

				// function drawMove (id, type) {
				// 	id.appendChild(sign);
				// 	id.innerHTML = type;
				// }


				// function drawMove(id, type) {
				// 	if (type == "cross")
				// 		id.onclick = function() {
				// 			this.appendChild(sign);
				// 			this.innerHTML = "X";
				// 	}	else {
				// 		id.onclick = function() {
				// 			this.appendChild(sign);
				// 			this.innerHTML = "O";
				// 	}
				// };
		</script>
	</body>
</html>
